---
// üîç P√°gina de debug para base de datos
import MainLayout from '../layouts/MainLayout.astro';

let dbStatus = "‚ùå Error desconocido";
let pokemonCount = 0;
let errorDetails = "";

try {
  // Intentar importar el servicio de DB
  const { getAllPokemon } = await import('../services/pokemonDB');
  
  try {
    // Intentar obtener todos los Pok√©mon
    const allPokemon = await getAllPokemon();
    pokemonCount = allPokemon.length;
    dbStatus = "‚úÖ Base de datos funcionando correctamente";
  } catch (dbError: any) {
    dbStatus = "‚ùå Error al consultar la base de datos";
    errorDetails = dbError?.toString() || "Error desconocido";
  }
} catch (importError: any) {
  dbStatus = "‚ùå Error al importar servicios de base de datos";
  errorDetails = importError?.toString() || "Error de importaci√≥n desconocido";
}

const pageTitle = "PokeDB - Database Debug";
---

<MainLayout title={pageTitle} description="P√°gina de debug para la base de datos">
	<div class="container mx-auto px-4 py-20">
		<h1 class="text-4xl font-bold text-center mb-8">
			üîç Database Debug
		</h1>
		
		<div class="max-w-2xl mx-auto space-y-6">
			<!-- Estado de la DB -->
			<div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg">
				<h2 class="text-2xl font-semibold mb-4">Estado de la Base de Datos</h2>
				<p class="text-lg mb-2">{dbStatus}</p>
				{pokemonCount > 0 && (
					<p class="text-green-600 dark:text-green-400">
						‚úÖ {pokemonCount} Pok√©mon encontrados en la base de datos
					</p>
				)}
			</div>

			<!-- Variables de entorno -->
			<div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg">
				<h2 class="text-2xl font-semibold mb-4">Variables de Entorno</h2>
				<div class="space-y-2 text-sm font-mono">
					<p>ASTRO_DB_REMOTE_URL: {import.meta.env.ASTRO_DB_REMOTE_URL ? "‚úÖ Configurada" : "‚ùå No configurada"}</p>
					<p>ASTRO_DB_APP_TOKEN: {import.meta.env.ASTRO_DB_APP_TOKEN ? "‚úÖ Configurada" : "‚ùå No configurada"}</p>
					<p>NODE_ENV: {import.meta.env.NODE_ENV || "undefined"}</p>
				</div>
			</div>

			<!-- Detalles del error -->
			{errorDetails && (
				<div class="bg-red-50 dark:bg-red-900 p-6 rounded-lg">
					<h2 class="text-2xl font-semibold mb-4 text-red-800 dark:text-red-200">Detalles del Error</h2>
					<pre class="text-sm text-red-700 dark:text-red-300 whitespace-pre-wrap overflow-x-auto">{errorDetails}</pre>
				</div>
			)}

			<!-- Informaci√≥n del entorno -->
			<div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg">
				<h2 class="text-2xl font-semibold mb-4">Informaci√≥n del Entorno</h2>
				<div class="space-y-2 text-sm">
					<p>Modo: {import.meta.env.MODE}</p>
					<p>SSR: {import.meta.env.SSR ? "Habilitado" : "Deshabilitado"}</p>
					<p>DEV: {import.meta.env.DEV ? "Desarrollo" : "Producci√≥n"}</p>
					<p>PROD: {import.meta.env.PROD ? "Producci√≥n" : "Desarrollo"}</p>
				</div>
			</div>
		</div>
	</div>
</MainLayout>
