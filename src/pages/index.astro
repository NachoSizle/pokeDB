---
// üè† P√°gina principal - PokeDB
// P√°gina est√°tica con componentes optimizados para SSG

export const prerender = true;

import MainLayout from '../layouts/MainLayout.astro';
import PokemonList from '../components/PokemonList.astro';
import AdvancedSearchModal from '../components/AdvancedSearchModal.astro';
import { getAllPokemon, type PokemonData } from '../services/pokemonDB';

const pageTitle = "PokeDB - Pok√©dex Completa";
const pageDescription = `Descubre todos los 151 Pok√©mon de la primera generaci√≥n. Base de datos optimizada con cach√© TTL y sprites oficiales.`;

// üöÄ Manejar par√°metro showAll para optimizar carga inicial
const url = Astro.url;
const showAll = url.searchParams.get('showAll') === 'true';

let pokemons: PokemonData[] = [];
if (showAll) {
  // Cargar todos los Pok√©mon solo si se solicita
  pokemons = await getAllPokemon();
}
---

<MainLayout title={pageTitle} description={pageDescription}>
	<!-- üé® Hero Section -->
	<section class="relative py-20 px-4" aria-labelledby="hero-heading">
		<div class="max-w-6xl mx-auto text-center">
			<h1 id="hero-heading" class="text-5xl md:text-7xl font-bold bg-gradient-to-r from-blue-600 via-purple-600 to-indigo-600 bg-clip-text text-transparent mb-6">
				PokeDB
			</h1>
			
			<p class="text-xl md:text-2xl text-gray-300 mb-8 max-w-3xl mx-auto text-enhanced">
				Explora la <strong>Pok√©dex completa</strong> con datos actualizados, sprites oficiales 
				y rendimiento optimizado con cach√© inteligente.
			</p>
			
			<!-- üîç Bot√≥n de b√∫squeda avanzada -->
			<div class="mb-8">
				<button 
					id="openSearchModal"
					type="button"
					aria-label="Abrir b√∫squeda avanzada de Pok√©mon"
					aria-describedby="search-description"
					class="inline-flex items-center gap-2 px-8 py-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl hover:from-purple-600 hover:to-pink-600 transition-all duration-300 transform hover:scale-105 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-purple-400 focus-visible:ring-offset-2"
				>
					<span aria-hidden="true">üîç</span>
					B√∫squeda Avanzada
					<span class="text-xs bg-white/20 px-2 py-1 rounded-full" aria-label="Nueva funcionalidad">Nuevo</span>
				</button>
				<div id="search-description" class="sr-only">
					Abre el modal de b√∫squeda avanzada para filtrar Pok√©mon por nombre, tipo y estad√≠sticas
				</div>
			</div>
			
			<!-- üìä Stats -->
			<div class="flex flex-wrap justify-center gap-8 mb-12" role="region" aria-labelledby="stats-heading">
				<h2 id="stats-heading" class="sr-only">Estad√≠sticas de la aplicaci√≥n</h2>
				<div class="bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm rounded-2xl px-6 py-4 shadow-lg" role="img" aria-label="151 Pok√©mon disponibles">
					<div class="text-3xl font-bold text-blue-600 dark:text-blue-400">151</div>
					<div class="text-sm text-gray-600 dark:text-gray-400">Pok√©mon</div>
				</div>
				
				<div class="bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm rounded-2xl px-6 py-4 shadow-lg" role="img" aria-label="Aplicaci√≥n optimizada con SSR">
					<div class="text-3xl font-bold text-purple-600 dark:text-purple-400">SSR</div>
					<div class="text-sm text-gray-600 dark:text-gray-400">Optimizado</div>
				</div>
				
				<div class="bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm rounded-2xl px-6 py-4 shadow-lg" role="img" aria-label="Cach√© de 24 horas TTL">
					<div class="text-3xl font-bold text-indigo-600 dark:text-indigo-400">24h</div>
					<div class="text-sm text-gray-600 dark:text-gray-400">Cach√© TTL</div>
				</div>
			</div>
		</div>
	</section>

	<!-- üéÆ Pokemon Grid -->
	<section class="pb-20 px-4" aria-labelledby="pokemon-grid-heading">
		<div class="max-w-7xl mx-auto">
			<h2 id="pokemon-grid-heading" class="sr-only">Lista de todos los Pok√©mon disponibles</h2>
			<PokemonList pokemons={pokemons} showInitialLoad={!showAll} />
		</div>
	</section>

	<!-- üîç Modal de B√∫squeda Avanzada -->
	<AdvancedSearchModal />
</MainLayout>

<!-- üöÄ Script para inicializar la b√∫squeda avanzada -->
<script>
	import { initAdvancedSearch } from '../scripts/advanced-search.js';
	
	// üéØ Inicializar cuando el DOM est√© listo
	document.addEventListener('DOMContentLoaded', initAdvancedSearch);
</script>